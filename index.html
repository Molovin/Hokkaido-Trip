<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Hokkaido Christmas Trip 2025</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        christmas: {
                            red: '#E63946',
                            dark: '#1D3557',
                            light: '#F1FAEE',
                            blue: '#457B9D',
                            snow: '#A8DADC'
                        }
                    },
                    fontFamily: {
                        sans: ['Noto Sans TC', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        /* éš±è—æ»¾å‹•æ¢ */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* é–å®šç•«é¢ï¼Œé˜²æ­¢æ©¡çš®ç­‹æ•ˆæœ */
        html, body {
            height: 100%;
            overflow: hidden;
            overscroll-behavior: none;
            background-color: #1D3557; /* èˆ‡ Header åŒè‰²ï¼Œé¿å…ä¸‹æ‹‰éœ²ç™½ */
        }

        /* App å®¹å™¨é«˜åº¦è¨­å®šï¼š
           ä½¿ç”¨ 100dvh (Dynamic Viewport Height) å®Œç¾é©æ‡‰ Safari å‹•æ…‹å·¥å…·åˆ— 
        */
        #app {
            height: 100dvh; 
            width: 100%;
            display: flex;
            flex-direction: column;
        }

        .header-bg {
            background-image: url('https://images.microcms-assets.io/assets/14d13bd618dc45c7b684223c0ca9d033/6a65e76092c949d3aaa7fd8a5a2046af/pixta_85703873_M.jpg');
            background-size: cover;
            background-position: center;
        }
        .header-blur {
            backdrop-filter: blur(10px); 
            -webkit-backdrop-filter: blur(10px);
        }

        /* é›ªèŠ±å‹•ç•« */
        .snowflake {
            position: absolute;
            top: -20px;
            color: #fff;
            user-select: none;
            z-index: 9999;
            pointer-events: none;
            will-change: transform;
            animation-name: fall;
            animation-timing-function: linear;
            animation-iteration-count: infinite;
        }

        @keyframes fall {
            0% { opacity: 0; transform: translate(0, -20px) rotate(0deg); }
            10% { opacity: 0.9; }
            25% { transform: translate(25px, 20vh) rotate(45deg); }
            50% { transform: translate(-25px, 50vh) rotate(90deg); }
            75% { transform: translate(25px, 80vh) rotate(135deg); }
            100% { opacity: 0.2; transform: translate(0, 110vh) rotate(180deg); }
        }
    </style>
</head>
<body>
    <div id="snow-container" class="fixed inset-0 pointer-events-none z-50"></div>

    <div id="app">
        <header class="relative shrink-0 z-20 overflow-hidden rounded-b-[2rem] shadow-xl flex flex-col justify-end transition-all duration-300 pt-[max(env(safe-area-inset-top),20px)] pb-4">
            <div class="absolute inset-0 header-bg"></div>
            <div class="absolute inset-0 bg-christmas-dark/80 header-blur"></div>
            
            <div class="relative z-10 px-6 mt-2">
                <div class="flex justify-between items-end mb-4">
                    <div>
                        <p class="text-christmas-snow text-[10px] font-bold tracking-wider mb-0.5 opacity-90">HOKKAIDO 2025</p>
                        <h1 class="text-2xl font-bold font-serif text-white shadow-black drop-shadow-md">Christmas Trip <i class="fa-solid fa-snowflake text-christmas-snow animate-pulse text-sm"></i></h1>
                    </div>
                    <div class="w-9 h-9 rounded-full bg-yellow-400 overflow-hidden border-2 border-white shadow-sm mb-1">
                        <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" alt="Profile" class="w-full h-full object-cover">
                    </div>
                </div>

                <div v-if="activeTab === 'itinerary'" class="flex space-x-2 overflow-x-auto no-scrollbar pb-1">
                    <div v-for="(date, index) in dates" :key="index" 
                         @click="selectedDate = date.day"
                         :class="['flex-shrink-0 w-12 h-16 rounded-xl flex flex-col items-center justify-center transition-all cursor-pointer border', 
                         selectedDate === date.day ? 'bg-christmas-red text-white border-christmas-red transform scale-105 shadow-md' : 'bg-white/10 text-white border-white/20 backdrop-blur-sm']">
                        <span class="text-[9px] opacity-80">{{ date.weekday }}</span>
                        <span class="text-lg font-bold">{{ date.day }}</span>
                    </div>
                </div>
                <div v-else class="mt-1 pb-2">
                    <h2 class="text-lg font-medium text-white opacity-90">{{ tabTitles[activeTab] }}</h2>
                </div>
            </div>
        </header>

        <main class="flex-1 overflow-y-auto no-scrollbar bg-[#f3f4f6] relative z-10 w-full">
            <div class="pt-6 px-4 pb-6">
                
                <div v-if="activeTab === 'itinerary'">
                    <div class="flex justify-between items-end mb-4 px-2">
                        <h3 class="text-xl font-bold text-gray-800">æ±äº¬è½‰æ©Ÿ <span class="text-sm font-normal text-gray-500 font-serif ml-2">Dec {{ selectedDate }}</span></h3>
                    </div>

                    <div class="flex space-x-3 overflow-x-auto no-scrollbar mb-6 py-1 px-1">
                        <div v-for="h in weather" :key="h.time" class="flex-shrink-0 w-16 h-20 bg-white rounded-xl shadow-sm flex flex-col items-center justify-center">
                            <span class="text-xs text-gray-400">{{ h.time }}</span>
                            <i :class="[h.icon, 'text-yellow-400 my-1 text-xl']"></i>
                            <span class="text-sm font-bold text-gray-700">{{ h.temp }}Â°</span>
                        </div>
                    </div>

                    <div class="relative pl-4 border-l-2 border-christmas-red/30 space-y-8 ml-2">
                        <div v-for="(item, idx) in filteredItinerary" :key="idx" class="relative">
                            <div class="absolute -left-[21px] top-0 w-4 h-4 rounded-full bg-white border-4 border-christmas-red"></div>
                            
                            <div class="bg-white rounded-2xl shadow-sm overflow-hidden ml-4 transform transition hover:scale-[1.01] duration-200">
                                <div v-if="item.image" class="h-32 w-full overflow-hidden relative group bg-gray-200">
                                    <img :src="item.image" referrerpolicy="no-referrer" class="w-full h-full object-cover transition duration-500 group-hover:scale-110" @error="imageError">
                                    <div class="absolute bottom-2 right-2 bg-black/50 text-white text-xs px-2 py-1 rounded-full backdrop-blur-md z-10">
                                        <i class="fa-regular fa-clock mr-1"></i> {{ item.time }}
                                    </div>
                                    <a :href="item.mapLink" target="_blank" class="absolute top-2 right-2 w-8 h-8 bg-white/90 text-christmas-blue rounded-full flex items-center justify-center backdrop-blur-md shadow-md z-30 hover:bg-christmas-blue hover:text-white transition-colors active:scale-90">
                                        <i class="fa-solid fa-location-arrow text-sm"></i>
                                    </a>
                                </div>
                                
                                <div class="p-4">
                                    <div class="flex items-center text-christmas-blue text-xs font-bold mb-1 uppercase tracking-wide">
                                        <i :class="[item.icon, 'mr-2']"></i> {{ item.category }}
                                    </div>
                                    <h4 class="text-lg font-bold text-gray-800 mb-1">{{ item.title }}</h4>
                                    <p class="text-sm text-gray-500 leading-relaxed">{{ item.desc }}</p>
                                    
                                    <div v-if="item.details" class="mt-3 bg-gray-50 p-3 rounded-lg flex justify-between items-center">
                                        <div class="text-center"><div class="text-xs text-gray-400">è·é›¢</div><div class="font-bold text-gray-700">{{ item.details.distance }}</div></div>
                                        <div class="text-center border-l border-r border-gray-200 px-4 w-full"><div class="text-xs text-gray-400">äº¤é€š</div><div class="font-bold text-gray-700">{{ item.details.transport }}</div></div>
                                        <div class="text-center"><div class="text-xs text-gray-400">åœç•™</div><div class="font-bold text-gray-700">{{ item.details.stay }}</div></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="h-10 text-center text-gray-300 text-xs mt-8">- End of Day -</div>
                </div>

                <div v-if="activeTab === 'map'" class="h-full flex flex-col">
                    <div class="bg-white p-2 rounded-xl shadow-sm mb-4">
                        <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3244.5910729792686!2d139.77764727677846!3d35.58882573503251!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x601861033282eb11%3A0xc6c76193796d857d!2z576955Sw5qZf5aC0!5e0!3m2!1szh-TW!2stw!4v1700000000000!5m2!1szh-TW!2stw" width="100%" height="400" style="border:0; border-radius: 12px;" allowfullscreen="" loading="lazy"></iframe>
                    </div>
                    <div class="bg-white p-4 rounded-xl shadow-sm">
                        <h3 class="font-bold text-gray-800 mb-2">Saved Locations</h3>
                        <ul class="space-y-3">
                            <li class="flex items-center text-gray-600 border-b pb-2"><i class="fa-solid fa-hotel text-christmas-red mr-3 w-6 text-center"></i> KEIKYU EX INN</li>
                            <li class="flex items-center text-gray-600 border-b pb-2"><i class="fa-solid fa-plane text-christmas-blue mr-3 w-6 text-center"></i> ç¾½ç”°æ©Ÿå ´ T2</li>
                        </ul>
                    </div>
                </div>

                <div v-if="activeTab === 'budget'">
                    <div class="bg-gradient-to-r from-christmas-blue to-christmas-dark text-white p-5 rounded-2xl shadow-lg mb-6">
                        <p class="text-sm opacity-80 mb-1">Total Expenses</p>
                        <h2 class="text-3xl font-bold">Â¥ {{ totalExpense.toLocaleString() }}</h2>
                        <div class="mt-4 flex gap-2">
                            <span class="bg-white/20 px-2 py-1 rounded text-xs">é ç®—: Â¥200,000</span>
                            <span class="bg-white/20 px-2 py-1 rounded text-xs">å‰©é¤˜: Â¥{{ (200000 - totalExpense).toLocaleString() }}</span>
                        </div>
                    </div>
                    <div class="bg-white p-4 rounded-xl shadow-sm mb-6">
                        <h3 class="font-bold text-gray-700 mb-3">å¿«é€Ÿè¨˜å¸³</h3>
                        <div class="flex gap-2 mb-2">
                            <input v-model="newExpense.title" type="text" placeholder="é …ç›®" class="flex-1 bg-gray-100 p-2 rounded-lg text-sm outline-none focus:ring-2 focus:ring-christmas-blue">
                            <input v-model.number="newExpense.amount" type="number" placeholder="Â¥" class="w-24 bg-gray-100 p-2 rounded-lg text-sm outline-none focus:ring-2 focus:ring-christmas-blue">
                        </div>
                        <button @click="addExpense" class="w-full bg-christmas-red text-white py-2 rounded-lg font-bold text-sm shadow-md active:scale-95 transition">æ–°å¢æ”¯å‡º</button>
                    </div>
                    <div class="space-y-3">
                        <div v-for="(exp, idx) in expenses" :key="idx" class="bg-white p-3 rounded-xl shadow-sm flex justify-between items-center">
                            <div class="flex items-center">
                                <div class="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center mr-3 text-lg">{{ getIcon(exp.title) }}</div>
                                <div><div class="font-bold text-gray-800">{{ exp.title }}</div><div class="text-xs text-gray-400">{{ exp.date }}</div></div>
                            </div>
                            <div class="font-bold text-christmas-red">-Â¥{{ exp.amount.toLocaleString() }}</div>
                        </div>
                    </div>
                </div>

                <div v-if="activeTab === 'shopping'">
                    <div class="bg-white p-4 rounded-xl shadow-sm mb-4">
                        <div class="flex gap-2">
                            <input v-model="newItem" @keyup.enter="addItem" type="text" placeholder="æƒ³è²·ä»€éº¼ï¼Ÿ" class="flex-1 bg-gray-100 p-3 rounded-lg outline-none focus:ring-2 focus:ring-christmas-blue">
                            <button @click="addItem" class="bg-christmas-dark text-white w-12 rounded-lg"><i class="fa-solid fa-plus"></i></button>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div v-for="(item, idx) in shoppingList" :key="idx" @click="item.checked = !item.checked"
                             :class="['p-4 rounded-xl shadow-sm transition-all cursor-pointer relative overflow-hidden', item.checked ? 'bg-gray-200' : 'bg-white']">
                            <div v-if="item.checked" class="absolute inset-0 flex items-center justify-center bg-black/10 z-10"><i class="fa-solid fa-check text-4xl text-green-500 opacity-50"></i></div>
                            <div class="flex justify-between items-start mb-2">
                                <i class="fa-solid fa-gift text-christmas-red"></i>
                                <div :class="['w-5 h-5 rounded-full border-2 flex items-center justify-center', item.checked ? 'border-green-500 bg-green-500' : 'border-gray-300']">
                                    <i v-if="item.checked" class="fa-solid fa-check text-white text-xs"></i>
                                </div>
                            </div>
                            <h4 :class="['font-bold', item.checked ? 'text-gray-500 line-through' : 'text-gray-800']">{{ item.name }}</h4>
                            <p class="text-xs text-gray-400 mt-1">å¿…è²·æ¸…å–®</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <nav class="shrink-0 bg-white w-full px-2 pt-3 pb-[calc(10px+env(safe-area-inset-bottom))] rounded-t-[2rem] shadow-[0_-10px_40px_rgba(0,0,0,0.05)] flex justify-around items-center z-20 relative">
            <button @click="activeTab = 'itinerary'" :class="['flex flex-1 flex-col items-center space-y-1 transition py-2', activeTab === 'itinerary' ? 'text-christmas-red' : 'text-gray-400']">
                <i class="fa-solid fa-calendar-days text-lg"></i><span class="text-[10px] font-bold">è¡Œç¨‹</span>
            </button>
            <button @click="activeTab = 'map'" :class="['flex flex-1 flex-col items-center space-y-1 transition py-2', activeTab === 'map' ? 'text-christmas-red' : 'text-gray-400']">
                <i class="fa-solid fa-map-location-dot text-lg"></i><span class="text-[10px] font-bold">åœ°åœ–</span>
            </button>
            <button @click="activeTab = 'budget'" :class="['flex flex-1 flex-col items-center space-y-1 transition py-2', activeTab === 'budget' ? 'text-christmas-red' : 'text-gray-400']">
                <i class="fa-solid fa-wallet text-lg"></i><span class="text-[10px] font-bold">è¨˜å¸³</span>
            </button>
            <button @click="activeTab = 'shopping'" :class="['flex flex-1 flex-col items-center space-y-1 transition py-2', activeTab === 'shopping' ? 'text-christmas-red' : 'text-gray-400']">
                <i class="fa-solid fa-bag-shopping text-lg"></i><span class="text-[10px] font-bold">è³¼ç‰©</span>
            </button>
        </nav>
    </div>

    <script>
        const { createApp, ref, computed, watch, onMounted } = Vue

        createApp({
            setup() {
                const activeTab = ref('itinerary')
                const selectedDate = ref(20)
                
                const tabTitles = { 'itinerary': 'è¡Œç¨‹è¡¨', 'map': 'æ¢ç´¢åœ°åœ–', 'budget': 'æ—…è¡Œè¨˜å¸³', 'shopping': 'è³¼ç‰©æ¸…å–®' }
                const dates = [{ day: 20, weekday: 'é€±å…­' }, { day: 21, weekday: 'é€±æ—¥' }, { day: 22, weekday: 'é€±ä¸€' }, { day: 23, weekday: 'é€±äºŒ' }, { day: 24, weekday: 'é€±ä¸‰' }]
                const weather = [
                    { time: '18:00', temp: 10, icon: 'fa-solid fa-moon' }, { time: '19:00', temp: 9, icon: 'fa-solid fa-moon' },
                    { time: '20:00', temp: 8, icon: 'fa-solid fa-moon' }, { time: '21:00', temp: 8, icon: 'fa-solid fa-moon' },
                    { time: '22:00', temp: 7, icon: 'fa-solid fa-cloud-moon' }
                ]

                const itineraryData = ref([
                    {
                        date: 20, time: '15:05', category: 'Flight', title: 'å»£å·å¾€æ±äº¬ (NH924)',
                        desc: 'ANA NH924ã€‚é è¨‚åƒè€ƒç·¨è™Ÿï¼šXK6OCGã€‚',
                        icon: 'fa-solid fa-plane-departure',
                        // ä½¿ç”¨ Pexels åœ–ç‰‡æ›¿ä»£ Unsplashï¼Œä¸¦å¢åŠ åœ–ç‰‡éŒ¯èª¤è™•ç†
                        image: 'https://images.pexels.com/photos/2026324/pexels-photo-2026324.jpeg?auto=compress&cs=tinysrgb&w=800', 
                        mapLink: 'https://www.google.com/maps/search/?api=1&query=Haneda+Airport', 
                        details: { distance: '2,900km', transport: '3h 55m', stay: 'èˆªç¨‹' }
                    },
                    {
                        date: 20, time: '20:00', category: 'Arrival', title: 'æŠµé”æ±äº¬ (ç¾½ç”°æ©Ÿå ´)',
                        desc: 'æŠµé”ç¾½ç”°æ©Ÿå ´ç¬¬2èˆªå»ˆ (T2)ã€‚',
                        icon: 'fa-solid fa-location-dot',
                        image: 'https://images.pexels.com/photos/1008155/pexels-photo-1008155.jpeg?auto=compress&cs=tinysrgb&w=800',
                        mapLink: 'https://www.google.com/maps/search/?api=1&query=Haneda+Airport+Terminal+2', 
                        details: { distance: 'æ©Ÿå ´å…§', transport: 'æ­¥è¡Œ', stay: '1h' }
                    },
                    {
                        date: 20, time: '21:30', category: 'Hotel', title: 'å…¥ä½ KEIKYU EX INN',
                        desc: 'ä½æ–¼å¤©ç©ºæ©‹ç«™ HICity å‡ºå£æ­¥è¡Œ2åˆ†é˜ã€‚',
                        icon: 'fa-solid fa-bed',
                        image: 'https://images.pexels.com/photos/271624/pexels-photo-271624.jpeg?auto=compress&cs=tinysrgb&w=800',
                        mapLink: 'https://www.google.com/maps/search/?api=1&query=KEIKYU+EX+INN+Haneda', 
                        details: { distance: 'ä¸€ç«™', transport: 'é›»è»Š', stay: 'éå¤œ' }
                    }
                ])

                const filteredItinerary = computed(() => itineraryData.value.filter(item => item.date === selectedDate.value))

                const savedExpenses = localStorage.getItem('trip_expenses')
                const expenses = ref(savedExpenses ? JSON.parse(savedExpenses) : [
                    { title: 'æ©Ÿå ´æ˜Ÿå·´å…‹', amount: 800, date: '12/20' }, { title: 'Lawson å®µå¤œ', amount: 1200, date: '12/20' }
                ])
                
                const savedShopping = localStorage.getItem('trip_shopping')
                const shoppingList = ref(savedShopping ? JSON.parse(savedShopping) : [
                    { name: 'ç™½è‰²æˆ€äºº', checked: false }, { name: 'è—¥å¦ (EVE)', checked: true }
                ])

                watch(expenses, (newVal) => localStorage.setItem('trip_expenses', JSON.stringify(newVal)), { deep: true })
                watch(shoppingList, (newVal) => localStorage.setItem('trip_shopping', JSON.stringify(newVal)), { deep: true })

                const newExpense = ref({ title: '', amount: '' })
                const addExpense = () => {
                    if(newExpense.value.title && newExpense.value.amount) {
                        expenses.value.unshift({ title: newExpense.value.title, amount: newExpense.value.amount, date: '12/' + selectedDate.value })
                        newExpense.value = { title: '', amount: '' }
                    }
                }
                const totalExpense = computed(() => expenses.value.reduce((sum, item) => sum + item.amount, 0))
                const getIcon = (title) => {
                    if(title.includes('é£Ÿ') || title.includes('æ‹‰éºµ')) return 'ğŸœ'; return 'ğŸ’¸';
                }

                const newItem = ref('')
                const addItem = () => {
                    if(newItem.value) { shoppingList.value.push({ name: newItem.value, checked: false }); newItem.value = '' }
                }

                const imageError = (e) => {
                    e.target.src = 'https://via.placeholder.com/600x400?text=No+Image';
                }

                onMounted(() => {
                    const snowContainer = document.getElementById('snow-container');
                    const createSnowflake = () => {
                        const snowflake = document.createElement('div');
                        snowflake.classList.add('snowflake');
                        snowflake.innerHTML = Math.random() > 0.5 ? 'â„' : 'â€¢';
                        snowflake.style.left = Math.random() * 100 + 'vw';
                        
                        const size = Math.random() * 8 + 6; 
                        snowflake.style.fontSize = size + 'px';
                        snowflake.style.opacity = Math.random() * 0.5 + 0.3;
                        
                        snowflake.style.animationDuration = (Math.random() * 10 + 15) + 's';
                        snowflake.style.animationDelay = Math.random() * 5 + 's';
                        
                        snowContainer.appendChild(snowflake);
                        setTimeout(() => snowflake.remove(), 25000); 
                    };
                    for(let i=0; i<8; i++) setTimeout(createSnowflake, i * 500);
                    setInterval(createSnowflake, 800);
                })

                return {
                    activeTab, dates, selectedDate, weather, filteredItinerary,
                    expenses, newExpense, addExpense, totalExpense, getIcon,
                    shoppingList, newItem, addItem, tabTitles, imageError
                }
            }
        }).mount('#app')
    </script>
</body>
</html>