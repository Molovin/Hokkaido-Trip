<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Hokkaido Christmas Trip 2025</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        christmas: {
                            red: '#E63946',
                            dark: '#1D3557',
                            light: '#F1FAEE',
                            blue: '#457B9D',
                            snow: '#A8DADC'
                        }
                    },
                    fontFamily: {
                        sans: ['Noto Sans TC', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        html, body {
            height: 100%;
            overflow: hidden;
            overscroll-behavior: none;
            background-color: #1D3557; 
        }

        #app {
            height: 100dvh; 
            width: 100%;
            display: flex;
            flex-direction: column;
        }

        .header-bg {
            background-image: url('https://images.microcms-assets.io/assets/14d13bd618dc45c7b684223c0ca9d033/6a65e76092c949d3aaa7fd8a5a2046af/pixta_85703873_M.jpg');
            background-size: cover;
            background-position: center;
        }
        
        .header-blur {
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
        }

        .snowflake {
            position: absolute;
            top: -20px;
            color: #fff;
            user-select: none;
            z-index: 9999;
            pointer-events: none;
            will-change: transform;
            animation-name: fall;
            animation-timing-function: linear;
            animation-iteration-count: infinite;
        }

        @keyframes fall {
            0% { opacity: 0; transform: translate(0, -20px) rotate(0deg); }
            10% { opacity: 0.9; }
            25% { transform: translate(25px, 20vh) rotate(45deg); }
            50% { transform: translate(-25px, 50vh) rotate(90deg); }
            75% { transform: translate(25px, 80vh) rotate(135deg); }
            100% { opacity: 0.2; transform: translate(0, 110vh) rotate(180deg); }
        }

        .fade-enter-active,
        .fade-leave-active {
            transition: opacity 0.2s ease, transform 0.2s ease;
        }
        .fade-enter-from { opacity: 0; transform: translateY(10px); }
        .fade-leave-to { opacity: 0; transform: translateY(-10px); }
        
        /* Loading Spinner */
        .loader {
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top: 3px solid #E63946;
            width: 20px;
            height: 20px;
            -webkit-animation: spin 1s linear infinite; /* Safari */
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="snow-container" class="fixed inset-0 pointer-events-none z-50"></div>

    <div id="app">
        <header class="relative shrink-0 z-20 overflow-hidden rounded-b-[2rem] shadow-xl flex flex-col justify-end transition-all duration-300 pt-[max(env(safe-area-inset-top),20px)] pb-4">
            <div class="absolute inset-0 header-bg"></div>
            <div class="absolute inset-0 bg-christmas-dark/40 header-blur"></div>
            
            <div class="relative z-10 px-6 mt-2">
                <div class="flex justify-between items-end mb-4">
                    <div>
                        <p class="text-christmas-snow text-[10px] font-bold tracking-wider mb-0.5 opacity-90">HOKKAIDO 2025</p>
                        <h1 class="text-2xl font-bold font-serif text-white shadow-black drop-shadow-md">Christmas Trip <i class="fa-solid fa-snowflake text-christmas-snow animate-pulse text-sm"></i></h1>
                    </div>
                    <div class="w-14 h-14 rounded-full bg-yellow-400 overflow-hidden border-2 border-white shadow-sm mb-1">
                        <img src="https://i.meee.com.tw/kYUJZ1x.png" alt="Profile" class="w-full h-full object-cover">
                    </div>
                </div>

                <div v-if="activeTab === 'itinerary'" class="flex space-x-3 overflow-x-auto no-scrollbar pb-1 px-1">
                    <div v-for="(date, index) in dates" :key="index" 
                         @click="selectedDate = date.day"
                         :class="['flex-shrink-0 w-16 h-20 rounded-xl flex flex-col items-center justify-center transition-all cursor-pointer border', 
                         selectedDate === date.day ? 'bg-christmas-red text-white border-christmas-red transform scale-105 shadow-md' : 'bg-white/10 text-white border-white/20 backdrop-blur-sm']">
                        <span class="text-[10px] opacity-80">{{ date.weekday }}</span>
                        <span class="text-xl font-bold">{{ date.day }}</span>
                    </div>
                </div>
                <div v-else class="mt-1 pb-2">
                    <h2 class="text-lg font-medium text-white opacity-90">{{ tabTitles[activeTab] }}</h2>
                </div>
            </div>
        </header>

        <main class="flex-1 overflow-y-auto no-scrollbar bg-[#f3f4f6] relative z-10 w-full">
            <div class="pt-6 px-4 pb-6">
                <transition name="fade" mode="out-in">
                    
                    <div v-if="activeTab === 'itinerary'" key="itinerary">
                        <div class="flex justify-between items-end mb-4 px-2">
                            <div>
                                <h3 class="text-xl font-bold text-gray-800">{{ currentLocationName }} <span class="text-sm font-normal text-gray-500 font-serif ml-2">Dec {{ selectedDate }}</span></h3>
                                <p class="text-[10px] text-christmas-blue/70 mt-1"><i class="fa-solid fa-satellite-dish mr-1"></i>Open-Meteo ç•¶åœ°å¯¦æ™‚å¤©æ°£</p>
                            </div>
                        </div>

                        <div class="relative min-h-[100px]">
                            <div v-if="weatherLoading" class="absolute inset-0 flex items-center justify-center bg-gray-50/50 z-10 rounded-xl">
                                <div class="loader"></div>
                            </div>

                            <div class="flex space-x-3 overflow-x-auto no-scrollbar mb-6 py-2 px-1">
                                <div v-for="(h, i) in hourlyWeather" :key="i" 
                                     :class="['flex-shrink-0 w-16 h-24 rounded-xl shadow-sm flex flex-col items-center justify-center border transition-all duration-500', 
                                     i === 0 ? 'bg-blue-50 border-christmas-blue/30 scale-105' : 'bg-white border-transparent']">
                                    <span class="text-[10px] text-gray-400 mb-1">{{ h.time }}</span>
                                    <i :class="[h.icon, i === 0 ? 'text-christmas-blue' : 'text-yellow-500', 'my-2 text-xl']"></i>
                                    <span class="text-sm font-bold text-gray-700">{{ h.temp }}Â°</span>
                                    <span v-if="i === 0" class="text-[9px] text-christmas-blue font-bold mt-1 bg-blue-100 px-1.5 rounded-full">NOW</span>
                                </div>
                            </div>
                        </div>

                        <div class="relative pl-4 border-l-2 border-christmas-red/30 space-y-8 ml-2">
                            <div v-if="filteredItinerary.length === 0" class="py-10 text-center text-gray-400">
                                <i class="fa-regular fa-calendar-xmark text-3xl mb-2 opacity-50"></i>
                                <p class="text-xs">é€™ä¸€å¤©ç›®å‰æ²’æœ‰å®‰æ’è¡Œç¨‹</p>
                            </div>

                            <div v-for="(item, idx) in filteredItinerary" :key="idx" class="relative">
                                <div class="absolute -left-[21px] top-0 w-4 h-4 rounded-full bg-white border-4 border-christmas-red"></div>
                                
                                <div class="bg-white rounded-2xl shadow-sm overflow-hidden ml-4 transform transition hover:scale-[1.01] duration-200">
                                    <div v-if="item.image" class="h-32 w-full overflow-hidden relative group bg-gray-200">
                                        <img :src="item.image" referrerpolicy="no-referrer" class="w-full h-full object-cover transition duration-500 group-hover:scale-110" @error="imageError">
                                        <div class="absolute bottom-2 right-2 bg-black/50 text-white text-xs px-2 py-1 rounded-full backdrop-blur-md z-10">
                                            <i class="fa-regular fa-clock mr-1"></i> {{ item.time }}
                                        </div>
                                        <a :href="item.mapLink" target="_blank" class="absolute top-2 right-2 w-8 h-8 bg-white/90 text-christmas-blue rounded-full flex items-center justify-center backdrop-blur-md shadow-md z-30 hover:bg-christmas-blue hover:text-white transition-colors active:scale-90">
                                            <i class="fa-solid fa-location-arrow text-sm"></i>
                                        </a>
                                    </div>
                                    
                                    <div class="p-4">
                                        <div class="flex items-center text-christmas-blue text-xs font-bold mb-1 uppercase tracking-wide">
                                            <i :class="[item.icon, 'mr-2']"></i> {{ item.category }}
                                        </div>
                                        <h4 class="text-lg font-bold text-gray-800 mb-1">{{ item.title }}</h4>
                                        <p class="text-sm text-gray-500 leading-relaxed">{{ item.desc }}</p>
                                        
                                        <div v-if="item.details" class="mt-3 bg-gray-50 p-3 rounded-lg flex justify-between items-center">
                                            <div class="text-center"><div class="text-xs text-gray-400">è·é›¢</div><div class="font-bold text-gray-700">{{ item.details.distance }}</div></div>
                                            <div class="text-center border-l border-r border-gray-200 px-4 w-full"><div class="text-xs text-gray-400">äº¤é€š</div><div class="font-bold text-gray-700">{{ item.details.transport }}</div></div>
                                            <div class="text-center"><div class="text-xs text-gray-400">åœç•™</div><div class="font-bold text-gray-700">{{ item.details.stay }}</div></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="h-10 text-center text-gray-300 text-xs mt-8">- End of Day -</div>
                    </div>

                    <div v-else-if="activeTab === 'map'" key="map" class="h-full flex flex-col">
                        <div class="bg-white p-2 rounded-xl shadow-sm mb-4">
                            <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3244.5910729792686!2d139.77764727677846!3d35.58882573503251!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x601861033282eb11%3A0xc6c76193796d857d!2z576955Sw5qZf5aC0!5e0!3m2!1szh-TW!2stw!4v1700000000000!5m2!1szh-TW!2stw" width="100%" height="400" style="border:0; border-radius: 12px;" allowfullscreen="" loading="lazy"></iframe>
                        </div>
                        <div class="bg-white p-4 rounded-xl shadow-sm">
                            <h3 class="font-bold text-gray-800 mb-2">Saved Locations</h3>
                            <ul class="space-y-3">
                                <li class="flex items-center text-gray-600 border-b pb-2"><i class="fa-solid fa-hotel text-christmas-red mr-3 w-6 text-center"></i> KEIKYU EX INN</li>
                                <li class="flex items-center text-gray-600 border-b pb-2"><i class="fa-solid fa-plane text-christmas-blue mr-3 w-6 text-center"></i> ç¾½ç”°æ©Ÿå ´ T2</li>
                            </ul>
                        </div>
                    </div>

                    <div v-else-if="activeTab === 'budget'" key="budget">
                        <div class="bg-gradient-to-r from-christmas-blue to-christmas-dark text-white p-5 rounded-2xl shadow-lg mb-6 relative overflow-hidden">
                            <div class="absolute top-0 right-0 -mr-4 -mt-4 w-24 h-24 rounded-full bg-white/10 blur-xl"></div>
                            <div class="flex justify-between items-start mb-1 relative z-10">
                                <p class="text-sm opacity-80">Total Expenses</p>
                                <span class="bg-white/20 px-2 py-0.5 rounded text-[10px] backdrop-blur-sm">â‰ˆ HKD ${{ totalExpenseHkd.toLocaleString() }}</span>
                            </div>
                            <h2 class="text-4xl font-bold relative z-10 mb-4 tracking-tight">Â¥ {{ totalExpense.toLocaleString() }}</h2>
                            <div class="flex gap-2 relative z-10">
                                <div class="bg-white/20 rounded-lg text-xs backdrop-blur-md flex items-center transition-all duration-200 border border-white/10 hover:bg-white/30 h-8">
                                    <div v-if="!isEditingBudget" @click="editBudget" class="px-3 h-full flex items-center cursor-pointer select-none">
                                        <span class="opacity-70 mr-1">é ç®—:</span> 
                                        <span class="font-bold">Â¥{{ budgetAmount.toLocaleString() }}</span>
                                        <i class="fa-solid fa-pen ml-2 text-[10px] opacity-60"></i>
                                    </div>
                                    <div v-else class="px-1 h-full flex items-center">
                                        <span class="pl-2 opacity-70 mr-1">Â¥</span>
                                        <input ref="budgetInputRef" v-model.number="budgetAmount" @blur="saveBudget" @keyup.enter="saveBudget" type="number" class="w-20 bg-transparent text-white font-bold outline-none placeholder-white/50">
                                    </div>
                                </div>
                                <div class="bg-white/20 px-3 h-8 flex items-center rounded-lg text-xs backdrop-blur-md border border-white/10">
                                    <span class="opacity-70 mr-1">å‰©é¤˜:</span> 
                                    <span :class="['font-bold', remaining < 0 ? 'text-red-300' : 'text-white']">Â¥{{ remaining.toLocaleString() }}</span>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white p-4 rounded-xl shadow-sm mb-6">
                            <h3 class="font-bold text-gray-700 mb-3 text-sm">æ–°å¢æ”¯å‡º</h3>
                            <div class="flex gap-2 mb-2">
                                <input v-model="newExpense.title" type="text" placeholder="é …ç›®" class="flex-1 bg-gray-100 p-2 rounded-lg text-sm outline-none focus:ring-2 focus:ring-christmas-blue">
                                <input v-model.number="newExpense.amount" type="number" placeholder="Â¥" class="w-24 bg-gray-100 p-2 rounded-lg text-sm outline-none focus:ring-2 focus:ring-christmas-blue">
                            </div>
                            <button @click="addExpense" class="w-full bg-christmas-red text-white py-2 rounded-lg font-bold text-sm shadow-md active:scale-95 transition">æ–°å¢</button>
                        </div>

                        <div class="space-y-3">
                            <div v-for="(exp, idx) in expenses" :key="idx" class="bg-white p-3 rounded-xl shadow-sm flex justify-between items-center group">
                                <div class="flex items-center">
                                    <div class="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center mr-3 text-lg">{{ getIcon(exp.title) }}</div>
                                    <div><div class="font-bold text-gray-800">{{ exp.title }}</div><div class="text-xs text-gray-400">{{ exp.date }}</div></div>
                                </div>
                                <div class="flex items-center gap-3">
                                    <div class="font-bold text-christmas-red">-Â¥{{ exp.amount.toLocaleString() }}</div>
                                    <button @click="deleteExpense(idx)" class="w-6 h-6 rounded-full bg-gray-100 text-gray-400 hover:bg-red-100 hover:text-red-500 flex items-center justify-center transition">
                                        <i class="fa-solid fa-trash-can text-xs"></i>
                                    </button>
                                </div>
                            </div>
                            <div v-if="expenses.length === 0" class="text-center text-gray-400 text-xs py-4">ç›®å‰æ²’æœ‰æ”¯å‡ºç´€éŒ„</div>
                        </div>
                    </div>

                    <div v-else-if="activeTab === 'shopping'" key="shopping">
                        <div class="bg-white p-4 rounded-xl shadow-sm mb-4">
                            <div class="flex gap-2">
                                <input v-model="newItem" @keyup.enter="addItem" type="text" placeholder="æƒ³è²·ä»€éº¼ï¼Ÿ" class="flex-1 bg-gray-100 p-3 rounded-lg outline-none focus:ring-2 focus:ring-christmas-blue">
                                <button @click="addItem" class="bg-christmas-dark text-white w-12 rounded-lg"><i class="fa-solid fa-plus"></i></button>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <div v-for="(item, idx) in shoppingList" :key="idx" @click="item.checked = !item.checked"
                                 :class="['p-4 rounded-xl shadow-sm transition-all cursor-pointer relative overflow-hidden group', item.checked ? 'bg-gray-200' : 'bg-white']">
                                <div v-if="item.checked" class="absolute inset-0 flex items-center justify-center bg-black/10 z-10"><i class="fa-solid fa-check text-4xl text-green-500 opacity-50"></i></div>
                                <div class="flex justify-between items-start mb-2">
                                    <i class="fa-solid fa-gift text-christmas-red"></i>
                                    <div class="flex gap-2">
                                        <div :class="['w-5 h-5 rounded-full border-2 flex items-center justify-center', item.checked ? 'border-green-500 bg-green-500' : 'border-gray-300']">
                                            <i v-if="item.checked" class="fa-solid fa-check text-white text-xs"></i>
                                        </div>
                                    </div>
                                </div>
                                <button @click.stop="deleteShoppingItem(idx)" class="absolute top-2 right-2 w-6 h-6 rounded-full bg-white/50 text-gray-400 hover:bg-red-500 hover:text-white flex items-center justify-center z-20 transition shadow-sm">
                                    <i class="fa-solid fa-trash-can text-[10px]"></i>
                                </button>
                                <h4 :class="['font-bold', item.checked ? 'text-gray-500 line-through' : 'text-gray-800']">{{ item.name }}</h4>
                                <p class="text-xs text-gray-400 mt-1">å¿…è²·æ¸…å–®</p>
                            </div>
                        </div>
                        <div v-if="shoppingList.length === 0" class="text-center text-gray-400 text-xs py-10">æ¸…å–®æ˜¯ç©ºçš„ï¼Œå¿«å»åŠ é»æ±è¥¿ï¼</div>
                    </div>
                </transition>
            </div>
        </main>

        <nav class="shrink-0 bg-white w-full px-2 pt-3 pb-[calc(10px+env(safe-area-inset-bottom))] rounded-t-[2rem] shadow-[0_-10px_40px_rgba(0,0,0,0.05)] flex justify-around items-center z-20 relative">
            <button @click="activeTab = 'itinerary'" :class="['flex flex-1 flex-col items-center space-y-1 transition py-2', activeTab === 'itinerary' ? 'text-christmas-red' : 'text-gray-400']">
                <i class="fa-solid fa-calendar-days text-lg"></i><span class="text-[10px] font-bold">è¡Œç¨‹</span>
            </button>
            <button @click="activeTab = 'map'" :class="['flex flex-1 flex-col items-center space-y-1 transition py-2', activeTab === 'map' ? 'text-christmas-red' : 'text-gray-400']">
                <i class="fa-solid fa-map-location-dot text-lg"></i><span class="text-[10px] font-bold">åœ°åœ–</span>
            </button>
            <button @click="activeTab = 'budget'" :class="['flex flex-1 flex-col items-center space-y-1 transition py-2', activeTab === 'budget' ? 'text-christmas-red' : 'text-gray-400']">
                <i class="fa-solid fa-wallet text-lg"></i><span class="text-[10px] font-bold">è¨˜å¸³</span>
            </button>
            <button @click="activeTab = 'shopping'" :class="['flex flex-1 flex-col items-center space-y-1 transition py-2', activeTab === 'shopping' ? 'text-christmas-red' : 'text-gray-400']">
                <i class="fa-solid fa-bag-shopping text-lg"></i><span class="text-[10px] font-bold">è³¼ç‰©</span>
            </button>
        </nav>
    </div>

    <script>
        const { createApp, ref, computed, watch, onMounted, nextTick } = Vue

        createApp({
            setup() {
                const activeTab = ref('itinerary')
                const selectedDate = ref(20)
                const weatherLoading = ref(false)
                
                const tabTitles = { 'itinerary': 'è¡Œç¨‹è¡¨', 'map': 'æ¢ç´¢åœ°åœ–', 'budget': 'æ—…è¡Œè¨˜å¸³', 'shopping': 'è³¼ç‰©æ¸…å–®' }
                
                const dates = [
                    { day: 20, weekday: 'é€±å…­' }, { day: 21, weekday: 'é€±æ—¥' }, { day: 22, weekday: 'é€±ä¸€' }, 
                    { day: 23, weekday: 'é€±äºŒ' }, { day: 24, weekday: 'é€±ä¸‰' }, { day: 25, weekday: 'é€±å››' }, 
                    { day: 26, weekday: 'é€±äº”' }, { day: 27, weekday: 'é€±å…­' }, { day: 28, weekday: 'é€±æ—¥' },
                    { day: 29, weekday: 'é€±ä¸€' }, { day: 30, weekday: 'é€±äºŒ' }
                ]

                // --- Open-Meteo Weather API Integration ---
                const hourlyWeather = ref([])
                
                // åœ°é»åº§æ¨™æ˜ å°„è¡¨ (æ ¹æ“šæ—¥æœŸ)
                const getLocationByDate = (date) => {
                    // 12/20: æ±äº¬ (ç¾½ç”°)
                    if (date === 20) return { lat: 35.5494, lon: 139.7798, name: 'æ±äº¬è½‰æ©Ÿ (Tokyo)' };
                    // 12/21: æœ­å¹Œ
                    if (date === 21) return { lat: 43.0618, lon: 141.3545, name: 'æœ­å¹Œ (Sapporo)' };
                    // 12/22-23: Tomamu (æ˜Ÿé‡)
                    if (date >= 22 && date <= 23) return { lat: 43.0626, lon: 142.6113, name: 'Tomamu' };
                    // 12/24: å°æ¨½
                    if (date === 24) return { lat: 43.1907, lon: 140.9947, name: 'å°æ¨½ (Otaru)' };
                    // 12/25-29: æœ­å¹Œå‘¨é‚Š/å…¶ä»–
                    return { lat: 43.0618, lon: 141.3545, name: 'åŒ—æµ·é“ (Hokkaido)' };
                }

                const currentLocationName = computed(() => getLocationByDate(selectedDate.value).name)

                // WMO å¤©æ°£ä»£ç¢¼è½‰ Icon
                const getWeatherIcon = (code) => {
                    if (code <= 1) return 'fa-solid fa-sun'; // æ™´
                    if (code <= 3) return 'fa-solid fa-cloud-sun'; // å¤šé›²
                    if (code <= 48) return 'fa-solid fa-smog'; // éœ§
                    if (code <= 67) return 'fa-solid fa-cloud-rain'; // é›¨
                    if (code <= 77) return 'fa-regular fa-snowflake'; // é›ª
                    if (code <= 82) return 'fa-solid fa-cloud-showers-heavy'; // å¤§é›¨
                    if (code <= 86) return 'fa-solid fa-snowflake'; // å¤§é›ª
                    if (code <= 99) return 'fa-solid fa-bolt'; // é›·é›¨
                    return 'fa-solid fa-cloud';
                }

                const fetchWeather = async () => {
                    weatherLoading.value = true;
                    try {
                        const loc = getLocationByDate(selectedDate.value);
                        // æŠ“å–æœªä¾† 24 å°æ™‚é å ±
                        const response = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${loc.lat}&longitude=${loc.lon}&hourly=temperature_2m,weathercode&timezone=Asia%2FTokyo&forecast_days=1`);
                        const data = await response.json();
                        
                        // è™•ç†æ•¸æ“šï¼šå–å‡ºç¾åœ¨æ™‚åˆ»ä¹‹å¾Œçš„ 12-24 å°æ™‚
                        const currentHour = new Date().getHours();
                        const mappedData = [];
                        
                        // ç°¡å–®å°æ‡‰ API å›å‚³çš„ hourly é™£åˆ— (0-23)
                        for(let i = currentHour; i < 24; i++) {
                            mappedData.push({
                                time: `${i}:00`,
                                temp: Math.round(data.hourly.temperature_2m[i]),
                                icon: getWeatherIcon(data.hourly.weathercode[i])
                            });
                        }
                        // å¦‚æœå‰©ä¸‹çš„æ™‚é–“å¤ªå°‘ï¼Œè£œæ˜å¤©çš„ (ç‚ºäº† demo ç°¡å–®ï¼Œé€™è£¡å¦‚æœè¶…é 24 é»å°±å¾ªç’°æ•¸æ“šæˆ–é¡¯ç¤º --)
                        if(mappedData.length < 5) {
                            for(let i=0; i<5; i++) {
                                mappedData.push({ time: `0${i}:00`, temp: '--', icon: 'fa-solid fa-moon' }); 
                            }
                        }
                        
                        hourlyWeather.value = mappedData;
                    } catch (e) {
                        console.error("Weather fetch failed", e);
                        // Fallback data
                        hourlyWeather.value = [{ time: 'Error', temp: '--', icon: 'fa-solid fa-triangle-exclamation' }];
                    } finally {
                        weatherLoading.value = false;
                    }
                }

                // ç›£è½æ—¥æœŸè®ŠåŒ–ï¼Œé‡æ–°æŠ“å–è©²åœ°å¤©æ°£
                watch(selectedDate, () => {
                    fetchWeather();
                }, { immediate: true })


                // --- Itinerary Data ---
                const itineraryData = ref([
                    {
                        date: 20, time: '15:05', category: 'Flight', title: 'å»£å·å¾€æ±äº¬ (NH924)',
                        desc: 'ANA NH924ã€‚é è¨‚åƒè€ƒç·¨è™Ÿï¼šXK6OCGã€‚',
                        icon: 'fa-solid fa-plane-departure',
                        image: 'https://images.pexels.com/photos/2026324/pexels-photo-2026324.jpeg?auto=compress&cs=tinysrgb&w=800', 
                        mapLink: 'https://www.google.com/maps/search/?api=1&query=Haneda+Airport', 
                        details: { distance: '2,900km', transport: '3h 55m', stay: 'èˆªç¨‹' }
                    },
                    {
                        date: 20, time: '20:00', category: 'Arrival', title: 'æŠµé”æ±äº¬ (ç¾½ç”°æ©Ÿå ´)',
                        desc: 'æŠµé”ç¾½ç”°æ©Ÿå ´ç¬¬2èˆªå»ˆ (T2)ã€‚',
                        icon: 'fa-solid fa-location-dot',
                        image: 'https://images.pexels.com/photos/1008155/pexels-photo-1008155.jpeg?auto=compress&cs=tinysrgb&w=800',
                        mapLink: 'https://www.google.com/maps/search/?api=1&query=Haneda+Airport+Terminal+2', 
                        details: { distance: 'æ©Ÿå ´å…§', transport: 'æ­¥è¡Œ', stay: '1h' }
                    },
                    {
                        date: 20, time: '21:30', category: 'Hotel', title: 'å…¥ä½ KEIKYU EX INN',
                        desc: 'ä½æ–¼å¤©ç©ºæ©‹ç«™ HICity å‡ºå£æ­¥è¡Œ2åˆ†é˜ã€‚',
                        icon: 'fa-solid fa-bed',
                        image: 'https://images.pexels.com/photos/271624/pexels-photo-271624.jpeg?auto=compress&cs=tinysrgb&w=800',
                        mapLink: 'https://www.google.com/maps/search/?api=1&query=KEIKYU+EX+INN+Haneda', 
                        details: { distance: 'ä¸€ç«™', transport: 'é›»è»Š', stay: 'éå¤œ' }
                    },
                    {
                        date: 21, time: '09:00', category: 'Flight', title: 'é£›å¾€æœ­å¹Œ',
                        desc: 'æº–å‚™å‰å¾€åŒ—æµ·é“ï¼è¨˜å¾—ç©¿æš–å’Œä¸€é»ã€‚',
                        icon: 'fa-solid fa-plane',
                        image: 'https://images.unsplash.com/photo-1548181655-46e326292b0c?q=80&w=600&auto=format&fit=crop',
                        mapLink: 'https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3244.5910729792686!2d139.77764727677846!3d35.58882573503251!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x601861033282eb11%3A0xc6c76193796d857d!2z576955Sw5qZf5aC0!5e0!3m2!1szh-TW!2stw!4v1700000000000!5m2!1szh-TW!2stw',
                        details: { distance: '820km', transport: '1h 30m', stay: 'èˆªç¨‹' }
                    }
                ])

                const filteredItinerary = computed(() => itineraryData.value.filter(item => item.date === selectedDate.value))

                const savedExpenses = localStorage.getItem('trip_expenses')
                const expenses = ref(savedExpenses ? JSON.parse(savedExpenses) : [
                    { title: 'æ©Ÿå ´æ˜Ÿå·´å…‹', amount: 800, date: '12/20' }
                ])
                
                const savedBudget = localStorage.getItem('trip_budget')
                const budgetAmount = ref(savedBudget ? JSON.parse(savedBudget) : 200000)
                const isEditingBudget = ref(false)
                const budgetInputRef = ref(null)

                const savedShopping = localStorage.getItem('trip_shopping')
                const shoppingList = ref(savedShopping ? JSON.parse(savedShopping) : [
                    { name: 'ç™½è‰²æˆ€äºº', checked: false }
                ])

                watch(expenses, (newVal) => localStorage.setItem('trip_expenses', JSON.stringify(newVal)), { deep: true })
                watch(budgetAmount, (newVal) => localStorage.setItem('trip_budget', JSON.stringify(newVal)))
                watch(shoppingList, (newVal) => localStorage.setItem('trip_shopping', JSON.stringify(newVal)), { deep: true })

                const newExpense = ref({ title: '', amount: '' })
                const addExpense = () => {
                    if(newExpense.value.title && newExpense.value.amount) {
                        expenses.value.unshift({ title: newExpense.value.title, amount: newExpense.value.amount, date: '12/' + selectedDate.value })
                        newExpense.value = { title: '', amount: '' }
                    }
                }
                const deleteExpense = (index) => {
                    if(confirm('ç¢ºå®šè¦åˆªé™¤é€™ç­†æ”¯å‡ºå—ï¼Ÿ')) expenses.value.splice(index, 1);
                }

                const totalExpense = computed(() => expenses.value.reduce((sum, item) => sum + item.amount, 0))
                const remaining = computed(() => budgetAmount.value - totalExpense.value)
                const totalExpenseHkd = computed(() => (totalExpense.value * 0.052).toFixed(0))

                const editBudget = () => {
                    isEditingBudget.value = true
                    nextTick(() => { if(budgetInputRef.value) budgetInputRef.value.focus() })
                }
                const saveBudget = () => {
                    isEditingBudget.value = false
                    if(budgetAmount.value < 0) budgetAmount.value = 0
                }

                const getIcon = (title) => {
                    if(title.includes('é£Ÿ') || title.includes('æ‹‰éºµ')) return 'ğŸœ'; return 'ğŸ’¸';
                }

                const newItem = ref('')
                const addItem = () => {
                    if(newItem.value) { shoppingList.value.push({ name: newItem.value, checked: false }); newItem.value = '' }
                }
                const deleteShoppingItem = (index) => {
                    if(confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹é …ç›®å—ï¼Ÿ')) shoppingList.value.splice(index, 1);
                }

                const imageError = (e) => {
                    e.target.src = 'https://via.placeholder.com/600x400?text=No+Image';
                }

                onMounted(() => {
                    const snowContainer = document.getElementById('snow-container');
                    const createSnowflake = () => {
                        const snowflake = document.createElement('div');
                        snowflake.classList.add('snowflake');
                        snowflake.innerHTML = Math.random() > 0.5 ? 'â„' : 'â€¢';
                        snowflake.style.left = Math.random() * 100 + 'vw';
                        const size = Math.random() * 8 + 6; 
                        snowflake.style.fontSize = size + 'px';
                        snowflake.style.opacity = Math.random() * 0.5 + 0.3;
                        snowflake.style.animationDuration = (Math.random() * 10 + 15) + 's';
                        snowflake.style.animationDelay = Math.random() * 5 + 's';
                        snowContainer.appendChild(snowflake);
                        setTimeout(() => snowflake.remove(), 25000); 
                    };
                    for(let i=0; i<8; i++) setTimeout(createSnowflake, i * 500);
                    setInterval(createSnowflake, 800);
                })

                return {
                    activeTab, dates, selectedDate, hourlyWeather, filteredItinerary,
                    expenses, newExpense, addExpense, deleteExpense, totalExpense, getIcon,
                    budgetAmount, isEditingBudget, editBudget, saveBudget, budgetInputRef, remaining, totalExpenseHkd,
                    shoppingList, newItem, addItem, deleteShoppingItem, tabTitles, imageError,
                    currentLocationName, weatherLoading
                }
            }
        }).mount('#app')
    </script>
</body>
</html>